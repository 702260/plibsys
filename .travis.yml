env:
        global:
                # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
                #   via the "travis encrypt" command using the project repo's public key
                - secure: "Jw8Q8kFOfP4kiicGpZX496H0Hhi2+PzQ5wSpSJ/+e4rdQ/PnQuCvJfyAJ/k6+7BmgeS80T4sfK5xB5nX3yZG1FA4VE4kXuppJlVSwTZer0dlbbK3rvdSChBf5/Nnfjsj/Ch2SjjwhOt8zhjVutWuT2wz9RwOO39heQf3KFb4qbaVbnaBRTiGYJ+6D/28dX5foMehTohtcN1WKUZULum4cP8tqdn2+0cH+afwDwODap4v8brEW8HifS4QGDejAE7zR9fr3BaJl2m9s8art5lGzoK6Qaf2SS8WBW0MVzv2CP6zfsLUmPm3WijGUzAIPPi5GRFSy7O0GdkhHziMof1vyE3irXLSFlhg5g76lHEI2vpE6m+/PQ4I9jp7+oBT0N4SadgiXReXxewAZRrInCOstNN/mWIF0C0r1gWvPS3uM5u4PfGRa72GJ39SWmDvQqmOHOy15ZGA2eyw8piLAVkVJKvhufNfwEULITHE9xQXCV3e0YZrNIjMofuRszz7yLHEXlhwJxG++E4h0uCKnCqLTcLas8sBcRw98H/k9s8yZR3u9v0F0qqX/wus2TvfMjsfOqMm9MyqTXexpsMiODiN0a8zpdhufDlyxgr+2S96NlER7Iu0aRPBVgfDP2COPxmVW4ZwDpZYxK6iANeiYVuQGHccDHjZRyiSCG2c47EKV14="
                - COVERITY_SCAN_PROJECT_NAME="saprykin/plibsys"
                - COVERITY_SCAN_BRANCH_PATTERN="coverity_scan"
                - COVERITY_SCAN_NOTIFICATION_EMAIL="xelfium@gmail.com"
                - COVERITY_SCAN_BUILD_COMMAND="make"

language: generic
sudo: false

matrix:
        include:
                - os: linux
                  addons:
                        apt:
                                sources:
                                        - ubuntu-toolchain-r-test
                                packages:
                                        - gcc-4.9
                                        - g++-4.9
                                        - libboost-test-dev
                  env:
                        - CC=gcc-4.9
                        - CXX=g++-4.9
                - os: linux
                  addons:
                        apt:
                                sources:
                                        - ubuntu-toolchain-r-test
                                packages:
                                        - gcc-5
                                        - g++-5
                                        - libboost-test-dev
                  env:
                        - CC=gcc-5
                        - CXX=g++-5
                - os: linux
                  addons:
                        apt:
                                sources:
                                        - ubuntu-toolchain-r-test
                                packages:
                                        - gcc-6
                                        - g++-6
                                        - libboost-test-dev
                                        - lcov
                  env:
                        - CC=gcc-6
                        - CXX=g++-6                        
                        - GCOV=gcov-6
                        - USE_GCOV=1
                - os: linux
                  addons:
                        apt:
                                packages:
                                        - libboost-test-dev
                  env:
                        - CC=clang
                        - CXX=clang++
                - os: linux
                  addons:
                        apt:
                                sources:
                                        - ubuntu-toolchain-r-test
                                        - llvm-toolchain-precise-3.6
                                packages:
                                        - clang-3.6
                                        - libc++-dev
                                        - libboost-test-dev
                  env:
                        - CC=clang-3.6
                        - CXX=clang++-3.6
                - os: linux
                  addons:
                        apt:
                                sources:
                                        - ubuntu-toolchain-r-test
                                        - llvm-toolchain-precise-3.7
                                packages:
                                        - clang-3.7
                                        - libc++-dev
                                        - libboost-test-dev
                  env:
                        - CC=clang-3.7
                        - CXX=clang++-3.7
                - os: linux
                  addons:
                        apt:
                                sources:
                                        - ubuntu-toolchain-r-test
                                        - llvm-toolchain-precise-3.8
                                packages:
                                        - clang-3.8
                                        - libc++-dev
                                        - libboost-test-dev
                  env:
                        - CC=clang-3.8
                        - CXX=clang++-3.8
                - os: linux
                  addons:
                        apt:
                                sources:
                                        - ubuntu-toolchain-r-test
                                        - sourceline: 'deb http://apt.llvm.org/precise/ llvm-toolchain-precise-3.9 main'
                                          key_url: 'http://apt.llvm.org/llvm-snapshot.gpg.key'
                                packages:
                                        - clang-3.9
                                        - libc++-dev
                                        - libboost-test-dev
                  env:
                        - CC=clang-3.9
                        - CXX=clang++-3.9
                - os: osx
                  compiler: gcc
                  env:
                        - CC=gcc
                        - CXX=g++
                        - GCOV=gcov
                        - USE_GCOV=1
                - os: osx
                  compiler: clang
                  env:
                        - CC=clang
                        - CXX=clang++

branches:
        only:
                - master
                - coverity_scan

before_install:
        - if [[ "${TRAVIS_BRANCH}" == "coverity_scan" ]]; then export USE_GCOV="" ; fi
        - if [[ "${USE_GCOV}" == "1" ]] && [[ "${TRAVIS_OS_NAME}" == "osx" ]]; then brew update ; brew install lcov ; fi

before_script:
        - mkdir ./plibsys-build
        - cd ./plibsys-build
        - $CC --version
        - $CXX --version
        - if [[ "${USE_GCOV}" == "1" ]]; then cmake -DPLIBSYS_COVERAGE=ON -DCMAKE_C_COMPILER=$CC -DCMAKE_CXX_COMPILER=$CXX .. ; else cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_C_COMPILER=$CC -DCMAKE_CXX_COMPILER=$CXX .. ; fi
        - if [[ "${TRAVIS_BRANCH}" == "coverity_scan" ]] && [[ "${TRAVIS_OS_NAME}" == "linux" ]]; then curl -s "https://scan.coverity.com/scripts/travisci_build_coverity_scan.sh" | bash || true ; fi

script:
        - make -j 2
        - if [[ "${TRAVIS_BRANCH}" != "coverity_scan" ]]; then ctest --output-on-failure -V -C Release; fi

after_success:
        - if [[ "${USE_GCOV}" == "1" ]]; then lcov --gcov-tool $GCOV --directory . --capture --output-file coverage.info ; fi
        - if [[ "${USE_GCOV}" == "1" ]]; then bash <(curl -s https://codecov.io/bash) ; fi
